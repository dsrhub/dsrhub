name: opendsr-identity-resolution
title_format: 'opendsr-identity-resolution {{.input.url}}'
description: opendsr identity resolution
auto_runnable: true
result_format:
  identity_type: '{{.step.identity_resolution.output.identity_type}}'
  identity_format: '{{.step.identity_resolution.output.identity_format}}'
  identity_value: '{{.step.identity_resolution.output.identity_value}}'

inputs:
- name: url
  description: request url
  default: 'http://openmock:9999/service-candidate-id/opendsr/identity_resolution'
- name: identity_type
  description: identity type
  default: email
  legal_values:
    - email
    - candidate_id
    - ios_advertising_id
    - android_advertising_id
    - android_id
- name: identity_format
  description: identity format
  default: raw
  legal_values:
    - md5
    - raw
    - sha1
    - sha256
- name: identity_value
  description: identity value
  default: zzzz@example.com

steps:
  identity_resolution:
    description: Map incoming identity to the service's supported identity type
    action:
      type: http
      configuration:
        url: '{{.input.url}}'
        method: POST
        body: >
          {
            "identity_type": "{{.input.identity_type}}",
            "identity_format": "{{.input.identity_format}}",
            "identity_value": "{{.input.identity_value}}"
          }
