version: '1.0'
workflows:
  demo_workflow_1:
    name: demo_workflow_1
    description: demo the first workflow
    timeout: 60 # seconds
    tasks:
      task_1:
        action: sync_http
        input:
          url: 'https://httpbin.org/get'
          method: GET
        timeout: 5
      task_2:
        action: sync_http
        input:
          url: 'https://httpbin.org/post'
          method: POST
        timeout: 5
        requires:
          - task_1
      task_3:
        action: async_http
        input:
          url: 'http://localhost:9999/async_http_callback'
          method: POST
          await:
            http_listen:
              condition: '{{ .Output.HTTPListenRequestBody | jsonPath "subject_request_id" | eq .WorkflowID }}'
        publish:
          subject_request_id: '{{ .Output.HTTPListenRequestBody | jsonPath "subject_request_id" }}'
          request_status: '{{ .Output.HTTPListenRequestBody | jsonPath "request_status" }}'
        timeout: 5
        requires:
          - task_1
          - task_2
      task_4:
        action: async_http
        input:
          url: 'http://localhost:9999/async_http_polling'
          method: POST
          await:
            http_polling:
              condition: '{{ .Output.HTTPPollingResponseBody | jsonPath "subject_request_id" | eq .WorkflowID }}'
              url: 'http://localhost:9999/async_http_polling'
              method: GET
              schedule: ''
              max_count: 10
        publish:
          subject_request_id: '{{ .Output.HTTPPollingResponseBody | jsonPath "subject_request_id" }}'
          request_status: '{{ .Output.HTTPPollingResponseBody | jsonPath "request_status" }}'
        timeout: 5
        requires:
          - task_1
          - task_2



